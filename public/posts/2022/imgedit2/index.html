<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>Image editor in C: Part II | xnacly - blog</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="Writing a basic image editor as a comp science project, Part II">
<meta name="generator" content="Hugo 0.101.0" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />







  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">‚Üê</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	
		<a href="https://xnacly.vercel.app">Portfolio</a>
	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">Image editor in C: Part II</h1>

    <div class="tip">
        <time datetime="2022-03-09 00:00:00 &#43;0000 UTC">Mar 9, 2022</time>
        <span class="split">
          ¬∑
        </span>
        <span>
          1971 words
        </span>
        <span class="split">
          ¬∑
        </span>
        <span>
          10 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#the-pgm-handler">The PGM handler</a>
      <ul>
        <li><a href="#image-data-structure">Image data structure</a></li>
        <li><a href="#the-createimage-method">The <code>createImage</code> method</a></li>
        <li><a href="#the-freeimage-method">The <code>freeImage</code> method</a></li>
        <li><a href="#the-copyimage-method">The <code>copyImage</code> method</a></li>
        <li><a href="#the-loadimage-method">The <code>loadImage</code> method</a></li>
        <li><a href="#the-saveimage-method">The <code>saveImage</code> method</a></li>
      </ul>
    </li>
    <li><a href="#the-utility-methods">The Utility methods</a></li>
    <li><a href="#conclusion-so-far">Conclusion so far</a></li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <p>Today I will lay out the structure and functions of the <code>util</code> and <code>pgm</code> libraries. Generally speaking, you should take
all the following code and explanations with a grain of salt due to me not being very proficient in and with C.</p>
<h2 id="the-pgm-handler">The PGM handler <a href="#the-pgm-handler" class="anchor">üîó</a></h2><p>Located in <code>src/libs/pgm/</code> the file contains all the functions showcased in the header file
<a href="https://xnacly.vercel.app/blog/image_editor_part_1#Files" target="_blank" rel="noopener">here</a>.</p>
<p>We will get started with the easiest methods, working our way up to the harder functions.</p>
<p>The very first thing however will be me explaining the mandatory data structure we had to use.</p>
<h3 id="image-data-structure">Image data structure <a href="#image-data-structure" class="anchor">üîó</a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">typedef</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> width;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> height;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> <span style="color:#f92672">**</span>data;
</span></span><span style="display:flex;"><span>} Image;
</span></span></code></pre></div><p>Even though this is pretty self-explanatory, we should talk about the third value of the structure. The <code>int **data</code>
defines a double pointer containing each and every pixel from an image.</p>
<p>For instance, one can access the value of a pixel at the coordinates <code>x=0</code> and <code>y=0</code> by using the following snippet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Image <span style="color:#f92672">*</span>img <span style="color:#f92672">=</span> createImage(<span style="color:#ae81ff">25</span>,<span style="color:#ae81ff">25</span>,<span style="color:#ae81ff">255</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> pixel_value_at_coords <span style="color:#f92672">=</span> img<span style="color:#f92672">-&gt;</span>data[x][y];
</span></span><span style="display:flex;"><span>printf(<span style="color:#e6db74">&#34;pixel at (%d,%d): %d&#34;</span>, x,y,pixel_value_at_coords);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Result: pixel at (0,0): 255
</span></span></span></code></pre></div><p>As one can see, there is a function used in line 1 which wasn&rsquo;t introduced yet: <code>createImage()</code></p>
<h3 id="the-createimage-method">The <code>createImage</code> method <a href="#the-createimage-method" class="anchor">üîó</a></h3><p>This method is crucial for several other methods, such as <code>copyImage()</code> and <code>loadImage()</code>.</p>
<p>Create Image contains the following code, which we will walk through step by step:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Image <span style="color:#f92672">*</span><span style="color:#a6e22e">createImage</span>(<span style="color:#66d9ef">int</span> width, <span style="color:#66d9ef">int</span> height, <span style="color:#66d9ef">int</span> default_brightness) {
</span></span><span style="display:flex;"><span>  Image <span style="color:#f92672">*</span>img;
</span></span><span style="display:flex;"><span>  img <span style="color:#f92672">=</span> malloc(<span style="color:#66d9ef">sizeof</span> <span style="color:#f92672">*</span>img);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  img<span style="color:#f92672">-&gt;</span>width <span style="color:#f92672">=</span> width;
</span></span><span style="display:flex;"><span>  img<span style="color:#f92672">-&gt;</span>height <span style="color:#f92672">=</span> height;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  img<span style="color:#f92672">-&gt;</span>data <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">**</span>)malloc(height <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> height; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    img<span style="color:#f92672">-&gt;</span>data[i] <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>)malloc(width <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> ii <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; ii <span style="color:#f92672">&lt;</span> width; ii<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      img<span style="color:#f92672">-&gt;</span>data[i][ii] <span style="color:#f92672">=</span> default_brightness;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> img;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Foremost in Line one, we define the return type to be of type <code>Image</code>. Remember, we defined this structure at the
beginning. We define three parameters in the method head, which all share the type <code>int</code>.</p>
<p>Line two declares the variable <code>*img</code> of type <code>Image</code>-pointer, which we will return later. Line three allocates memory
for this variable, allowing us to store data in this variable.</p>
<p>The Lines four and five are assigning the values of our function parameters to the variables in the structure using the
arrow operator (<code>-&gt;</code>).</p>
<p>Right in the next line, we have a rather complicated line of code which allocates the double pointer to, again, allow us
to store data in it. Let&rsquo;s take a closer look at this line of code by splitting it in three parts:</p>
<ul>
<li><code>img-&gt;data =</code>: assigns everything right of <code>=</code> to the <code>data</code> variable in the <code>img</code> pointer</li>
<li><code>(int **)</code>: <code>malloc</code> returns <code>void*</code>, therefore we need to cast this pointer into a double <code>int</code> pointer</li>
<li><code>malloc(height * sizeof(int *))</code></li>
</ul>
<p>The last one is a bit tricky:</p>
<p>We know we use <code>malloc</code> to allocate memory, but what does <code>height * sizeof(int *)</code> do, and why do we need to use it
here? The answer is simpler than you think.:</p>
<p>Basically, the data field is an array of pointers, each of them is filled with exactly as many pixels as the height is
big. Let&rsquo;s visualize this concept:</p>
<table>
<thead>
<tr>
<th>Image</th>
<th>Width: 0</th>
<th>Width: 1</th>
<th>Width: 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>Height: 0</td>
<td>0,0</td>
<td>0,1</td>
<td>0,2</td>
</tr>
<tr>
<td>Height: 1</td>
<td>1,0</td>
<td>1,1</td>
<td>1,2</td>
</tr>
<tr>
<td>Height: 2</td>
<td>2,0</td>
<td>2,1</td>
<td>2,2</td>
</tr>
</tbody>
</table>
<p>You should notice our point of origin being in the top right, learn why
<a href="https://gamedev.stackexchange.com/questions/83570/why-is-the-origin-in-computer-graphics-coordinates-at-the-top-left" target="_blank" rel="noopener">here</a>.
This means you can mentally visualize this concept by simply flipping the known coordinate system upside down, meaning
0,0 is in the top left corner instead of the bottom left corner. As you can see, in this example the array contains
three arrays with height, therefore we allocate the field with the size of <code>height*sizeof(int)</code>. To explain in simple
terms, we tell the compiler to expect three fields of height, which we will later each fill with values.</p>
<p>After explaining this line in depth, we will now take a closer look at the for loops of this function. The first one
loops over the columns of the field we just allocated and allocates each one of these rows with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>img<span style="color:#f92672">-&gt;</span>data[i] <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>)malloc(width <span style="color:#f92672">*</span> <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>));
</span></span><span style="display:flex;"><span><span style="color:#75715e">// cast *void into *int, allocate as many items as there are pixels for each height, e.g.: 0-1080, 1-1080, 2-1080
</span></span></span></code></pre></div><p>The second loop assigns the default value specified in the function parameter <code>default_brightness</code> to every pixel in the
data field.</p>
<h3 id="the-freeimage-method">The <code>freeImage</code> method <a href="#the-freeimage-method" class="anchor">üîó</a></h3><p>This method enables memory management for the main menu.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">freeImage</span>(Image <span style="color:#f92672">**</span>img_pointer) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span>(<span style="color:#f92672">*</span>img_pointer <span style="color:#f92672">==</span> NULL) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>  free(<span style="color:#f92672">*</span>img_pointer);
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">*</span>img_pointer <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>Pointers in C are passed by value not by reference, this means editing a pointer inside a function is only possible by
passing the address of the pointer to the function.</p>
</blockquote>
<p>Not much to explain here, the first line makes the function do nothing if the pointer is already <code>NULL</code>. The second line
frees the given pointer, and the third line assigns <code>NULL</code> to the just freed pointer. This is necessary due to the fact
that pointers can still point to random memory after being assigned.</p>
<p>More Info <a href="https://moviecultists.com/does-freeing-a-pointer-set-it-to-null" target="_blank" rel="noopener">here</a> and
<a href="https://en.wikipedia.org/wiki/C_dynamic_memory_allocation" target="_blank" rel="noopener">here</a>.</p>
<h3 id="the-copyimage-method">The <code>copyImage</code> method <a href="#the-copyimage-method" class="anchor">üîó</a></h3><p>This method performs a deep copy of the given Image pointer and returns it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Image <span style="color:#f92672">*</span><span style="color:#a6e22e">copyImage</span>(Image <span style="color:#f92672">*</span>img_pointer) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> width <span style="color:#f92672">=</span> img_pointer<span style="color:#f92672">-&gt;</span>width;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> height <span style="color:#f92672">=</span> img_pointer<span style="color:#f92672">-&gt;</span>height;
</span></span><span style="display:flex;"><span>  Image <span style="color:#f92672">*</span>cpImage <span style="color:#f92672">=</span> createImage(width, height, <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> height; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> ii <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; ii <span style="color:#f92672">&lt;</span> width; ii<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>      cpImage<span style="color:#f92672">-&gt;</span>data[i][ii] <span style="color:#f92672">=</span> img_pointer<span style="color:#f92672">-&gt;</span>data[i][ii];
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> cpImage;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Line one and two assign the height and width of the passed image to temporary variables. Line 3 creates a new image. The
two <code>for</code>-loops loop over every item in every column and every row, allowing for a deep copy to be made.</p>
<h3 id="the-loadimage-method">The <code>loadImage</code> method <a href="#the-loadimage-method" class="anchor">üîó</a></h3><p>This method was by far the hardest of any code to implement in the whole project. Wrapping my head around reading files
and parsing their contents was such a struggle and cost me a lot of time.</p>
<p>The method‚Äôs head is defined as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Image <span style="color:#f92672">*</span><span style="color:#a6e22e">loadImage</span>(<span style="color:#66d9ef">char</span> file_name[]) {
</span></span></code></pre></div><p>The method can be called by passing a file name with path to the <code>file_name</code> parameter.</p>
<p>In line 1 we open the file, by passing the given file name and the <code>‚Äúr‚Äù</code> parameter to indicate the mode we intend to
use: <em>See <code>fopen</code> man pages <a href="https://man7.org/linux/man-pages/man3/fopen.3.html" target="_blank" rel="noopener">here</a>.</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(file_name, <span style="color:#e6db74">&#34;r&#34;</span>);
</span></span></code></pre></div><p>Next we check if opening the file failed, if this is the case we return <code>NULL</code> to indicate failure.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (file <span style="color:#f92672">==</span> NULL)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> NULL;
</span></span></code></pre></div><p>Now we check if the file confirms to the <code>PGM/P2</code> standard, which I explained
<a href="https://xnacly.vercel.app/blog/image_editor_part_1#pgm-standard" target="_blank" rel="noopener">here</a>.</p>
<p>To do this, we first need to get the first character of the file, which should be a <code>P</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">char</span> pgm_prefix <span style="color:#f92672">=</span> getc(file);
</span></span></code></pre></div><p>Directly after, we declare some variables for later usage:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> pgm_version <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> width <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> height <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> brightness <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span></code></pre></div><p>Now we get the first integer of the file, which should, if the file is PGM conform, be a 2 or a 5. But in our case only
needing to support P2, we can simply test for that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// get first int of the file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>fscanf(file, <span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, <span style="color:#f92672">&amp;</span>pgm_version);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// check if first line of the file conforms to the pgm standard
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (pgm_prefix <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;P&#39;</span> <span style="color:#f92672">||</span> pgm_version <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>) {
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">return</span> NULL;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Remembering the explanation from <a href="https://xnacly.vercel.app/blog/image_editor_part_1#pgm-standard" target="_blank" rel="noopener">here</a>, we know the
second and third integers are the width and height and the fourth integer is the max brightness. To get these values, we
use <code>fscanf</code> again. We will need to check if the scanned variables are 0 or smaller than 0.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>fscanf(file, <span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>width);
</span></span><span style="display:flex;"><span>fscanf(file, <span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>height);
</span></span><span style="display:flex;"><span>fscanf(file, <span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>brightness);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (width <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> height <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> brightness <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> NULL;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>After establishing this solid foundation, we can now get started with creating the image and assigning all the values at
their respecting coordinates:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>Image <span style="color:#f92672">*</span>img <span style="color:#f92672">=</span> createImage(width, height, <span style="color:#ae81ff">255</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> height; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> ii <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; ii <span style="color:#f92672">&lt;</span> width; ii<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>	  fscanf(file, <span style="color:#e6db74">&#34;%d&#34;</span>, <span style="color:#f92672">&amp;</span>img<span style="color:#f92672">-&gt;</span>data[i][ii]);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Finally, we close the file and return the created Image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>fclose(file);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> img;
</span></span></code></pre></div><h3 id="the-saveimage-method">The <code>saveImage</code> method <a href="#the-saveimage-method" class="anchor">üîó</a></h3><p>This function saves the image to a file.</p>
<p>Opening file with mode <code>‚Äúw‚Äù</code> (write) and return 0 if opening failed.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>FILE <span style="color:#f92672">*</span>file <span style="color:#f92672">=</span> fopen(file_name, <span style="color:#e6db74">&#34;w&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (file <span style="color:#f92672">==</span> NULL) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now we print the first three lines, like the standard dictates.:</p>
<pre tabindex="0"><code>P2
width height
brightness
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>fprintf(file, <span style="color:#e6db74">&#34;P2</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">%d %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, img_pointer<span style="color:#f92672">-&gt;</span>width, img_pointer<span style="color:#f92672">-&gt;</span>height, MAX_BRIGHT);
</span></span></code></pre></div><p><code>*MAX_BRIGHT</code> is a macro in <code>_util.h</code> which I defined to be <code>255</code>.</p>
<p>To write all the pixel data into the file, we just loop over every pixel again and write the data to the file.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// loops over every pixel and appends the value to the file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> img_pointer<span style="color:#f92672">-&gt;</span>height; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> ii <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; ii <span style="color:#f92672">&lt;</span> img_pointer<span style="color:#f92672">-&gt;</span>width; ii<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>	  fprintf(file, <span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, img_pointer<span style="color:#f92672">-&gt;</span>data[i][ii]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The function ends with closing the file and returning one as the indicator for success.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>fclose(file);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span></code></pre></div><h2 id="the-utility-methods">The Utility methods <a href="#the-utility-methods" class="anchor">üîó</a></h2><p>This source file contains functions not fitting into the other modules. We have for example the compare function, which
is needed for a <code>qsort</code> call in the <code>median</code> function in <code>_image.c</code>.:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">compare</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>a, <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>b) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> int_a <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>((<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>)a);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> int_b <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>((<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>)b);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (int_a <span style="color:#f92672">==</span> int_b)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (int_a <span style="color:#f92672">&lt;</span> int_b)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>There is also the <code>toInt</code> method, which converts a string to an integer. I wrote this function after Clang told me
multiple times to refrain from using <code>scanf</code> and I should use <code>strtol</code> instead, so I did.:</p>
<p><code>strtol</code> documentation <a href="https://man7.org/linux/man-pages/man3/strtol.3.html" target="_blank" rel="noopener">here</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">toInt</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>text) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>ptr;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">long</span> l;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  l <span style="color:#f92672">=</span> strtol(text, <span style="color:#f92672">&amp;</span>ptr, <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">int</span>)l;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We also have two feedback methods to communicate errors and warnings to the user:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">throw_error</span>(<span style="color:#66d9ef">char</span> text[]) {
</span></span><span style="display:flex;"><span>  printf(<span style="color:#e6db74">&#34;%s%s%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ANSI_COLOR_RED, text, ANSI_RESET);
</span></span><span style="display:flex;"><span>  exit(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">throw_warning</span>(<span style="color:#66d9ef">char</span> text[]) {
</span></span><span style="display:flex;"><span>  printf(<span style="color:#e6db74">&#34;%s%s%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ANSI_COLOR_YELLOW, text, ANSI_RESET);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The last utility function is a check if the made selection in the main menu is a valid input:</p>
<p>Basically, if the selection is not in the defined range in the enum or there is currently no image in memory, disallow
the user to make edits to an image.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">check_is_option_valid</span>(<span style="color:#66d9ef">int</span> selection, <span style="color:#66d9ef">int</span> image_in_memory) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (selection <span style="color:#f92672">&gt;</span> SELECTION_EXIT) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> SELECTION_INVALID;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// disallow editing and saving if there is no file in mem
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (selection <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> selection <span style="color:#f92672">!=</span> SELECTION_EXIT <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>image_in_memory) {
</span></span><span style="display:flex;"><span>    throw_warning(<span style="color:#e6db74">&#34;No Image loaded into the program.&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> SELECTION_INVALID;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> selection;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="conclusion-so-far">Conclusion so far <a href="#conclusion-so-far" class="anchor">üîó</a></h2><p>For me personally, my lack of a sophisticated knowledge of c made the beginning and some parts of this project so far
very hard. I have some experience as a somewhat full-stack web-dev, but having to learn and use c in such a small amount
of time was very challenging. I had a hard time understanding pointers at first and made easily avoidable mistakes.
Whenever I searched online, I was feeling like there weren&rsquo;t that many resources. Linux man pages really helped me out,
but they don&rsquo;t introduce you to methods you could use for specific tasks, except of the <code>see also</code> section.</p>
<p>A big mistake I made from the beginning was to not read the PGM specification correctly, I just assumed I could access
all pixels by looping from 0 to width and in that loop, loop from 0 to height. This did in fact not work and gave me
headaches.</p>
<p>I also made the mistake of not knowing that pointers were passed by value not by reference, meaning the <code>freeImage</code>
method did in fact not free the memory taken up by the structures.</p>
<p>To conclude, I&rsquo;d say it was smart to start working on the project this early, as I it is about to be finished.</p>

    </div>

    
        <div class="tags">
            
                <a href="https://xnacly.github.io/blog/tags/c">c</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    
        <div id="social">


    <a class="symbol" href="https://github.com/xnacly" rel="me" target="_blank">
        
        <svg fill="#bbbbbb" width="28" height="28"  viewBox="0 0 72 72" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    
    <title>Github</title>
    <desc>Created with Sketch.</desc>
    <defs></defs>
    <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)">
            <g id="Github" transform="translate(264.000000, 939.000000)">
                <path d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z" id="Rounded" fill="#bbbbbb"></path>
                <path d="M35.9985,13 C22.746,13 12,23.7870921 12,37.096644 C12,47.7406712 18.876,56.7718301 28.4145,59.9584121 C29.6145,60.1797862 30.0525,59.4358488 30.0525,58.7973276 C30.0525,58.2250681 30.0315,56.7100863 30.0195,54.6996482 C23.343,56.1558981 21.9345,51.4693938 21.9345,51.4693938 C20.844,48.6864054 19.2705,47.9454799 19.2705,47.9454799 C17.091,46.4500754 19.4355,46.4801943 19.4355,46.4801943 C21.843,46.6503662 23.1105,48.9634994 23.1105,48.9634994 C25.2525,52.6455377 28.728,51.5823398 30.096,50.9649018 C30.3135,49.4077535 30.9345,48.3460615 31.62,47.7436831 C26.2905,47.1352808 20.688,45.0691228 20.688,35.8361671 C20.688,33.2052792 21.6225,31.0547881 23.1585,29.3696344 C22.911,28.7597262 22.0875,26.3110578 23.3925,22.9934585 C23.3925,22.9934585 25.4085,22.3459017 29.9925,25.4632101 C31.908,24.9285993 33.96,24.6620468 36.0015,24.6515052 C38.04,24.6620468 40.0935,24.9285993 42.0105,25.4632101 C46.5915,22.3459017 48.603,22.9934585 48.603,22.9934585 C49.9125,26.3110578 49.089,28.7597262 48.8415,29.3696344 C50.3805,31.0547881 51.309,33.2052792 51.309,35.8361671 C51.309,45.0917119 45.6975,47.1292571 40.3515,47.7256117 C41.2125,48.4695491 41.9805,49.9393525 41.9805,52.1877301 C41.9805,55.4089489 41.9505,58.0067059 41.9505,58.7973276 C41.9505,59.4418726 42.3825,60.1918338 43.6005,59.9554002 C53.13,56.7627944 60,47.7376593 60,37.096644 C60,23.7870921 49.254,13 35.9985,13" fill="#FFFFFF"></path>
            </g>
        </g>
    </g>
</svg>
    </a>


</div>

    

    <div class="copyright">
    
        
    
    </div>

    
</footer>



  </body>
</html>
